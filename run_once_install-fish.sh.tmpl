#!/bin/bash
# run_once_install-fish.sh.tmpl
# This script installs fish shell and sets it as the default shell

set -e

echo "Setting up fish shell..."

# Check if fish is already installed
if ! command -v fish &> /dev/null; then
    echo "Installing fish shell..."
    sudo pacman -S --noconfirm fish
    echo "✓ Fish installed successfully"
else
    echo "✓ Fish is already installed"
fi

# Get the current default shell
CURRENT_SHELL=$(basename "$SHELL")

# Set fish as default shell if it isn't already
if [ "$CURRENT_SHELL" != "fish" ]; then
    echo "Setting fish as default shell..."
    FISH_PATH=$(which fish)

    # Check if fish is in /etc/shells
    if ! grep -q "$FISH_PATH" /etc/shells; then
        echo "Adding fish to /etc/shells..."
        echo "$FISH_PATH" | sudo tee -a /etc/shells > /dev/null
    fi

    # Change default shell
    chsh -s "$FISH_PATH"
    echo "✓ Fish set as default shell (will take effect on next login)"
else
    echo "✓ Fish is already the default shell"
fi

echo "Fish setup complete!"
