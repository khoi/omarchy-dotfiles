#!/bin/bash
# run_once_initial-setup.sh.tmpl
# Initial system setup tasks that need to run once
# Add new setup functions below as needed

set -e

echo "Running initial system setup..."
echo

# ==============================================================================
# Setup Functions
# ==============================================================================

setup_fish_shell() {
    echo "Setting up fish shell..."

    # Check if fish is already installed
    if ! command -v fish &> /dev/null; then
        echo "  Installing fish shell..."
        sudo pacman -S --noconfirm fish
        echo "  ✓ Fish installed successfully"
    else
        echo "  ✓ Fish is already installed"
    fi

    # Get the current default shell
    CURRENT_SHELL=$(basename "$SHELL")

    # Set fish as default shell if it isn't already
    if [ "$CURRENT_SHELL" != "fish" ]; then
        echo "  Setting fish as default shell..."
        FISH_PATH=$(which fish)

        # Check if fish is in /etc/shells
        if ! grep -q "$FISH_PATH" /etc/shells; then
            echo "  Adding fish to /etc/shells..."
            echo "$FISH_PATH" | sudo tee -a /etc/shells > /dev/null
        fi

        # Change default shell
        chsh -s "$FISH_PATH"
        echo "  ✓ Fish set as default shell (will take effect on next login)"
    else
        echo "  ✓ Fish is already the default shell"
    fi

    echo
}

# ==============================================================================
# Add more setup functions here
# ==============================================================================

# setup_another_thing() {
#     echo "Setting up another thing..."
#     # Your setup code here
#     echo
# }

# ==============================================================================
# Main execution
# ==============================================================================

setup_fish_shell
# setup_another_thing

echo "Initial setup complete!"
